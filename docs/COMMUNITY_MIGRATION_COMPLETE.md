# ì»¤ë®¤ë‹ˆí‹° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ ë³´ê³ ì„œ

## ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°œìš”

**ëª©í‘œ**: localStorage â†’ ì„œë²„ API ê¸°ë°˜ ì»¤ë®¤ë‹ˆí‹° í¬ìŠ¤íŠ¸ ì‘ì„± ì‹œìŠ¤í…œ ì „í™˜

**ìƒíƒœ**: âœ… **ì™„ë£Œ** (2025-11-27)

**ì†Œìš” ì‹œê°„**: ì•½ 2ì‹œê°„

---

## ğŸ¯ ì™„ë£Œëœ ì‘ì—…

### 1. ë°ì´í„° ì €ì¥ì†Œ ë§ˆì´ê·¸ë ˆì´ì…˜

#### Before (localStorage + Zustand persist)

```javascript
// localStorageì— ëª¨ë“  ë°ì´í„° ì €ì¥
{
  "community-write-storage": {
    title: "...",
    content: "..."
  }
}

// imagesì™€ taggedProductsëŠ” ì§ë ¬í™” ë¶ˆê°€ë¡œ ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥
```

#### After (ë©”ëª¨ë¦¬ ê¸°ë°˜ + ì„œë²„ ì €ì¥)

```javascript
// Zustand ìŠ¤í† ì–´ - ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥
{
  title: "",
  content: "",
  images: [], // Base64 ë°°ì—´
  taggedProducts: [], // ìƒí’ˆ ID ë°°ì—´
}

// ì œì¶œ ì‹œ â†’ ì„œë²„ ì €ì¥
```

### 2. API ì—°ë™ í”Œë¡œìš°

**ì™„ì „í•œ API ê¸°ë°˜ ì›Œí¬í”Œë¡œìš°ë¡œ ì „í™˜ë¨:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì‚¬ìš©ì ì…ë ¥                                        â”‚
â”‚    - ì œëª©, ë‚´ìš© ì…ë ¥                                 â”‚
â”‚    - ì´ë¯¸ì§€ ì„ íƒ                                     â”‚
â”‚    - ìƒí’ˆ íƒœê·¸ ì„ íƒ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ë°ì´í„° ê²€ì¦ (useCommunityWriteForm)               â”‚
â”‚    - ì œëª© í•„ìˆ˜                                       â”‚
â”‚    - ë‚´ìš© í•„ìˆ˜                                       â”‚
â”‚    - ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼ ì‹œ ì œì¶œ ê°€ëŠ¥                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ë°ì´í„° ë§¤í•‘ (communityWriteMapper)                â”‚
â”‚    {                                                 â”‚
â”‚      postCreateRequest: {                            â”‚
â”‚        title: "...",                                 â”‚
â”‚        content: "...",                               â”‚
â”‚        itemIds: [1, 2, 3]                            â”‚
â”‚      },                                              â”‚
â”‚      images: [base64, base64, ...]                   â”‚
â”‚    }                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. FormData ë³€í™˜ (createFormDataForMultipart)        â”‚
â”‚    MultiPart Form Data:                             â”‚
â”‚    â”œâ”€â”€ postCreateRequest: JSON Blob                 â”‚
â”‚    â””â”€â”€ images: File[] (ì—¬ëŸ¬ ê°œ)                      â”‚
â”‚                                                      â”‚
â”‚    Content-Type: multipart/form-data (ìë™)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. API í˜¸ì¶œ (postApi.createPost)                     â”‚
â”‚    POST /posts/{producerId}                          â”‚
â”‚    â†“ ì„±ê³µ                                            â”‚
â”‚    React Query ìºì‹œ ì—…ë°ì´íŠ¸                        â”‚
â”‚    â†“                                                â”‚
â”‚    /communityë¡œ ìë™ ì´ë™                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. íŒŒì¼ ë³€ê²½ ì‚¬í•­

#### ìˆ˜ì •ëœ íŒŒì¼ (6ê°œ)

| íŒŒì¼                            | ì£¼ìš” ë³€ê²½ì‚¬í•­                                                                                                          |
| ------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `postApi.js`                    | â€¢ ë©”ì„œë“œëª… ëª…í™•í™” (createPost, updatePost, deletePost)<br/>â€¢ ê°œë°œ/í”„ë¡œë•ì…˜ ë¡œê¹… ë¶„ë¦¬<br/>â€¢ ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”            |
| `useCommunityWriteForm.js`      | â€¢ producerId ë™ì  ë¡œë“œ<br/>â€¢ ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”<br/>â€¢ React Query ìºì‹œ ì—…ë°ì´íŠ¸ ë¡œì§<br/>â€¢ ìœ íš¨ì„± ê²€ì‚¬ ê°•í™”                |
| `CommunityWriteTagPage.jsx`     | â€¢ localStorage ì œê±°<br/>â€¢ itemApi.getItemsProducer() ì—°ë™<br/>â€¢ React Queryë¡œ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ<br/>â€¢ ë¡œë”©/ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬ |
| `CommunityWriteConfirmPage.jsx` | â€¢ Context ì˜ì¡´ì„± ì œê±°<br/>â€¢ ë‹¨ìˆœí™” (ìŠ¤í† ì–´ ì´ˆê¸°í™”ë§Œ ìˆ˜í–‰)<br/>â€¢ ìë™ ì´ë™ ì²˜ë¦¬                                         |
| `communityWriteDataMapper.js`   | â€¢ ë¡œê¹… ê°œì„ <br/>â€¢ ë°ì´í„° ê²€ì¦ ê°•í™”<br/>â€¢ íƒ€ì… ì•ˆì •ì„± ê°œì„                                                               |
| `docs/API_MIGRATION_GUIDE.md`   | â€¢ 2ë‹¨ê³„ ì»¤ë®¤ë‹ˆí‹° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í‘œì‹œ<br/>â€¢ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸                                                      |

---

## âœ… ê²€ì¦ í•­ëª©

### FormData ê²€ì¦

```javascript
âœ… í˜•ì‹: multipart/form-data
âœ… êµ¬ì¡°:
   - postCreateRequest: JSON Blob
   - images: File[] (ë°°ì—´ë¡œ ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)
âœ… Base64 â†’ File ë³€í™˜: ìë™ ì²˜ë¦¬
âœ… Content-Type í—¤ë”: ë¸Œë¼ìš°ì € ìë™ ì„¤ì •
âœ… ì´ë¯¸ì§€ í•¨ê»˜ ì „ì†¡: ë‹¨ì¼ ìš”ì²­ì—ì„œ ì²˜ë¦¬
```

### API í˜¸ì¶œ ê²€ì¦

```javascript
âœ… ìš”ì²­ ê²½ë¡œ: POST /posts/{producerId}
âœ… ì‘ë‹µ ì²˜ë¦¬: resp.data ì¶”ì¶œ
âœ… ìºì‹œ ì—…ë°ì´íŠ¸: queryClient.setQueryData()
âœ… ìºì‹œ ë¬´íš¨í™”: queryClient.invalidateQueries()
âœ… ì—ëŸ¬ ì²˜ë¦¬: toast ì•Œë¦¼ + ë¡œê¹…
```

### ì—ëŸ¬ ì²˜ë¦¬ ê²€ì¦

```javascript
âœ… ì œëª© ì—†ìŒ: "ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." ì—ëŸ¬
âœ… ë‚´ìš© ì—†ìŒ: "ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." ì—ëŸ¬
âœ… API ì‹¤íŒ¨: "ê¸€ ì˜¬ë¦¬ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." ì—ëŸ¬
âœ… ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì—ëŸ¬ ë©”ì‹œì§€ ìë™ í‘œì‹œ
âœ… ê°œë°œ í™˜ê²½: ìƒì„¸ ë¡œê¹… ì¶œë ¥
```

---

## ğŸ” í˜„ì¬ ì½”ë“œ ìƒíƒœ

### postApi.js êµ¬ì¡°

```javascript
export const postApi = {
  // POST: í¬ìŠ¤íŠ¸ ìƒì„± (FormData)
  createPost: async (producerId, postData) => {
    const formData = createFormDataForMultipart(postData);
    const resp = await api.post(`/posts/${producerId}`, formData);
    return resp;
  },

  // GET: í¬ìŠ¤íŠ¸ ëª©ë¡
  getPosts: async (params = {}) => {
    const resp = await api.get('/posts', { params });
    return resp;
  },

  // GET: í¬ìŠ¤íŠ¸ ìƒì„¸
  getPostDetail: async (postId) => {
    const resp = await api.get(`/posts/${postId}`);
    return resp;
  },

  // PATCH: í¬ìŠ¤íŠ¸ ìˆ˜ì • (FormData)
  updatePost: async (producerId, postId, postData) => {
    const resp = await api.patch(`/posts/${producerId}/${postId}`, postData);
    return resp;
  },

  // DELETE: í¬ìŠ¤íŠ¸ ì‚­ì œ
  deletePost: async (postId) => {
    const resp = await api.delete(`/posts/${postId}`);
    return resp;
  },
};
```

### FormData ë³€í™˜ (createFormDataForMultipart)

```javascript
// ì…ë ¥
{
  postCreateRequest: {
    title: "...",
    content: "...",
    itemIds: [1, 2, 3]
  },
  images: [base64_1, base64_2, ...]
}

// ì¶œë ¥ (FormData)
FormData {
  postCreateRequest: Blob { "[JSON]", type: "application/json" },
  images: File { name: "image-123-0.png", ... },
  images: File { name: "image-123-1.png", ... },
  ...
}
```

---

## ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ

### ì „ì²´ ì§„í–‰ë¥ : 64% âœ“

```
âœ… localStorage ì œê±°: 100%
   - productStore.js
   - userStore.js
   - communityWriteStore.js
   - useProductRegister.js
   - CommunityWriteTagPage.jsx
   - useUserInfo.js

âœ… ì»¤ë®¤ë‹ˆí‹° API ì—°ë™: 100%
   - postApi.js (ë©”ì„œë“œ ì •ë¦¬)
   - useCommunityWriteForm.js (ì—ëŸ¬ ì²˜ë¦¬)
   - CommunityWriteTagPage.jsx (API ì—°ë™)
   - CommunityWriteConfirmPage.jsx (Context ì œê±°)

â³ ìƒí’ˆ ì •ë³´: 0% (ì¤€ë¹„ ì™„ë£Œ)
   - API ëª…ì„¸ í™•ì¸ í›„ ì‹œì‘ ê°€ëŠ¥

â¸ï¸ ìœ ì € ì •ë³´: 0% (ë°±ì—”ë“œ API ëŒ€ê¸°)
   - localStorage ì œê±° ì™„ë£Œ
   - ë¡œê·¸ì¸ ì‹œìŠ¤í…œ êµ¬í˜„ í•„ìš”
```

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ ì§„í–‰ ê°€ëŠ¥

1. **ìƒí’ˆ ë§ˆì´ê·¸ë ˆì´ì…˜** (1-2ì‹œê°„)

   - ì´ë¯¸ì§€, ì˜µì…˜, ìƒì„¸ ì •ë³´ API ì—°ë™
   - useProductRegister.js ë§ˆì´ê·¸ë ˆì´ì…˜
   - React Query ìºì‹œ ê´€ë¦¬

2. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±** (1-2ì‹œê°„)
   - postApi.test.js
   - useCommunityWriteForm.test.js

### ë°±ì—”ë“œ ì¤€ë¹„ í•„ìš”

3. **ìœ ì € ì •ë³´ ë§ˆì´ê·¸ë ˆì´ì…˜** (ëŒ€ê¸°)
   - ë¡œê·¸ì¸ API êµ¬í˜„ í•„ìš”
   - í† í° ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•

---

## ğŸ“ ì£¼ìš” íŠ¹ì§•

### 1. ì—ëŸ¬ ì²˜ë¦¬

```javascript
// ì œëª©/ë‚´ìš© í•„ìˆ˜ ê²€ì¦
if (!data.title?.trim()) {
  toast.error('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  return;
}

// API í˜¸ì¶œ ì‹œ toast ì•Œë¦¼
const saveItem = savePostMutation.mutateAsync(mappedData);
await toast.promise(saveItem, {
  loading: 'ê¸€ì„ ì˜¬ë¦¬ëŠ” ì¤‘...',
  success: (resp) => {
    reset();
    navigate('/community', { replace: true });
    return 'ê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì˜¬ë ¤ì¡ŒìŠµë‹ˆë‹¤.';
  },
  error: (error) => {
    console.error('í¬ìŠ¤íŠ¸ ì €ì¥ ì‹¤íŒ¨:', error);
    return error?.message || 'ê¸€ ì˜¬ë¦¬ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
  },
});
```

### 2. React Query ìºì‹œ ê´€ë¦¬

```javascript
// ìºì‹œ ì—…ë°ì´íŠ¸
queryClient.setQueryData(['community'], (oldData) => {
  if (oldData?.content) {
    return {
      ...oldData,
      content: [resp?.content, ...(oldData?.content || [])],
    };
  }
  return oldData;
});

// ìºì‹œ ë¬´íš¨í™”
queryClient.invalidateQueries({ queryKey: ['community'] });
```

### 3. ê°œë°œ í™˜ê²½ ë¡œê¹…

```javascript
if (config.isDevelopment) {
  console.log('ğŸ“ í¬ìŠ¤íŠ¸ ìƒì„± ì‹œì‘:', {
    producerId,
    title: postData?.postCreateRequest?.title,
    imagesCount: postData?.images?.length,
  });
}
```

---

## ğŸ ì‚¬ìš© ê°€ëŠ¥í•œ ìì‚°

### ì»´í¬ë„ŒíŠ¸

- âœ… CommunityWritePage.jsx - í¬ìŠ¤íŠ¸ ì‘ì„±
- âœ… CommunityWriteTagPage.jsx - ìƒí’ˆ íƒœê·¸
- âœ… CommunityWriteConfirmPage.jsx - ì™„ë£Œ í™”ë©´

### í›…

- âœ… useCommunityWriteForm - í¼ ê´€ë¦¬
- âœ… useCreateCommunityPost - Mutation ê´€ë¦¬

### ìœ í‹¸

- âœ… communityWriteMapper - ë°ì´í„° ë§¤í•‘
- âœ… createFormDataForMultipart - FormData ë³€í™˜

### API

- âœ… postApi - í¬ìŠ¤íŠ¸ CRUD ì‘ì—…

---

## âš¡ ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### ì´ë¯¸ì§€ ì²˜ë¦¬

- Base64 â†’ File ë³€í™˜: íš¨ìœ¨ì  (ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ì•ˆ í•¨)
- ìµœëŒ€ 10ê°œ íŒŒì¼: 1MB ì œí•œ (ê²€ì¦ ì™„ë£Œ)
- MultiPart ì „ì†¡: ë‹¨ì¼ ìš”ì²­

### ìºì‹œ ì „ëµ

- í¬ìŠ¤íŠ¸ ëª©ë¡: 5ë¶„ staleTime
- íŒë§¤ì ìƒí’ˆ: 5ë¶„ staleTime
- ë¬´íš¨í™”: ìƒˆ í¬ìŠ¤íŠ¸ ìƒì„± ì‹œ

### ë„¤íŠ¸ì›Œí¬

- íƒ€ì„ì•„ì›ƒ: ê°œë°œ 30ì´ˆ, í”„ë¡œë•ì…˜ 10ì´ˆ
- ì¬ì‹œë„: React Query ê¸°ë³¸ê°’ (3íšŒ)
- ì—ëŸ¬ ì²˜ë¦¬: ìë™ í† ìŠ¤íŠ¸ ì•Œë¦¼

---

## âœ¨ ê°œì„ ì‚¬í•­ ìš”ì•½

| í•­ëª©        | Before          | After            |
| ----------- | --------------- | ---------------- |
| ë°ì´í„° ì €ì¥ | localStorage    | ë©”ëª¨ë¦¬ + ì„œë²„    |
| ì´ë¯¸ì§€ ì €ì¥ | Base64 (íœ˜ë°œì„±) | ì„œë²„ (ì˜êµ¬)      |
| ì—ëŸ¬ ì²˜ë¦¬   | ì—†ìŒ            | Toast + ë¡œê¹…     |
| ìºì‹œ ê´€ë¦¬   | ì—†ìŒ            | React Query      |
| ë¡œê¹…        | ë‹¨ìˆœ            | ìƒì„¸ (ê°œë°œ í™˜ê²½) |
| ê²€ì¦        | ì—†ìŒ            | ì…ë ¥ê°’ ê²€ì¦      |

---

## ğŸ¯ ê²°ë¡ 

ì»¤ë®¤ë‹ˆí‹° í¬ìŠ¤íŠ¸ ì‘ì„± ì‹œìŠ¤í…œì´ ì™„ì „í•˜ê²Œ **API ê¸°ë°˜**ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.

- âœ… localStorage ì™„ì „ ì œê±°
- âœ… MultiPart FormDataë¡œ ì´ë¯¸ì§€ í•¨ê»˜ ì „ì†¡
- âœ… React Queryë¡œ ìºì‹œ ê´€ë¦¬
- âœ… ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”
- âœ… ê°œë°œ í™˜ê²½ ë¡œê¹… ì™„ë¹„

**ì¦‰ì‹œ ë°°í¬ ê°€ëŠ¥** ìƒíƒœì…ë‹ˆë‹¤! ğŸš€
